@using System.Globalization
@using SchulCloud.Frontend.Enums
@using SchulCloud.Frontend.Options;

@inherits LayoutComponentBase

<MudThemeProvider @bind-IsDarkMode="_isDarkMode" ObserveSystemThemeChange="false" />

<MudLayout>
    <MudAppBar>
        @{
            PresentationOptions.Favicon? favicon = PresentationOptionsAccessor.Value.Favicons.FirstOrDefault(fav => fav.Sizes == "any");
            favicon ??= PresentationOptionsAccessor.Value.Favicons.FirstOrDefault();

            if (favicon is not null)
            {
                <MudImage Class="mr-2" Src="@favicon.Path" Width="40" Fluid />
            }
        }
        <MudText Class="mr-10" Typo="Typo.h5">@PresentationOptionsAccessor.Value.ApplicationName</MudText>

        <MudButton Href="@Routes.Login()">
            <MudIcon Class="d-inline me-2" Icon="@MaterialSymbols.Outlined.Login" />
            @Localizer["signInLink"]
        </MudButton>
        <MudButton Href="@Routes.Privacy()">@Localizer["privacyLink"]</MudButton>

        <MudSpacer />

        @{
            string colorThemeKey = _isDarkMode ? "Light" : "Dark";
        }
        <MudTooltip Class="mx-3" Text="@Localizer[$"selectColorTheme_{colorThemeKey}"]">
            <MudToggleIconButton Toggled="!_isDarkMode" ToggledChanged="IsDarkMode_ChangedAsync"
                                 Icon="@MaterialSymbols.Outlined.LightMode" ToggledIcon="@MaterialSymbols.Outlined.DarkMode" />
        </MudTooltip>

        <MudMenu Label="@(_culture?.NativeName ?? Localizer["selectCulture_Auto"])" StartIcon="@MaterialSymbols.Outlined.Translate" EndIcon="@MaterialSymbols.Outlined.KeyboardArrowDown">
            <MudMenuItem Disabled="@(_culture is null)" OnClick="@(async () => await ChangeCulture_ClickAsync(null))">
                <MudStack AlignItems="AlignItems.Center" Row>
                    <MudIcon Icon="@MaterialSymbols.Outlined.Language" />
                    @Localizer["selectCulture_Auto"]
                </MudStack>
            </MudMenuItem>

            @foreach (CultureInfo culture in LocalizationOptions.SupportedUICultures ?? [])
            {
                <MudMenuItem Disabled="culture.Equals(_culture)" OnClick="@(async () => await ChangeCulture_ClickAsync(culture))">
                    <MudStack AlignItems="AlignItems.Center" Row>
                        <MudImage Height="30" Src="@Assets[$"/_content/SchulCloud.Frontend/{culture.Name.Replace('-', '_')}.svg"]" Alt="@culture.Name" />
                        @culture.NativeName
                    </MudStack>
                </MudMenuItem>
            }
        </MudMenu>
    </MudAppBar>

    <MudMainContent Class="pt-16 px-2">
        <MudContainer Class="mt-15">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>